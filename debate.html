<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Debate Voting</title>
<style>
body { font-family: Arial, sans-serif; background: #1e1e1e; color: #fff; padding:20px;}
h1 { color: #00ffcc; }
button { padding: 10px; margin:5px; cursor: pointer; background:#00ffcc; border:none; color:#000; font-weight:bold; }
button:disabled { background: #555; cursor: not-allowed; color: #ccc; }
.question { background:#252526; padding:10px; margin-bottom:10px; border-radius:5px; }
.vote-bar { background:#00ffcc; height: 20px; border-radius: 5px; margin-top:5px; transition: width 0.3s;}
</style>
</head>
<body>
<h1>Debate Voting</h1>
<div id="questions"></div>

<script>
async function fetchQuestions() {
    const res = await fetch('/questions');
    const data = await res.json();
    const container = document.getElementById('questions');
    container.innerHTML = '';
    
    data.questions.forEach(q => {
        const hasVoted = localStorage.getItem(`voted_${q.id}`);
        const div = document.createElement('div');
        div.className = 'question';
        div.innerHTML = `
            <p>${q.text}</p>
            <button onclick="vote('${q.id}')" ${hasVoted ? 'disabled' : ''}>Vote</button>
            <p>Votes: ${q.votes}</p>
            <div class="vote-bar" style="width:${q.votes * 20}px;"></div>
        `;
        container.appendChild(div);
    });
}

async function vote(id) {
    if(localStorage.getItem(`voted_${id}`)) return;

    await fetch('/vote', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ id })
    });

    localStorage.setItem(`voted_${id}`, 'true'); // mark as voted
    fetchQuestions();
}

// Live update every 2 seconds
fetchQuestions();
setInterval(fetchQuestions, 2000);
</script>
</body>
</html>
